<!-- chat/chat.html -->
{% extends "users/base.html" %}
{% load static %}

{% block content %}
<style>
    .chat-container {
        max-width: 800px;
        margin: 2rem auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        padding: 2rem;
    }

    .message-list {
        height: 60vh;
        overflow-y: auto;
        padding: 1rem;
        border: 2px solid #f8f9fa;
        border-radius: 12px;
        margin-bottom: 1.5rem;
    }

    .message {
        margin-bottom: 1.5rem;
        padding: 1rem;
        border-radius: 12px;
        background: #f8f9fa;
    }

    .message.sent {
        background: #2f9e44;
        color: white;
        margin-left: 20%;
    }

    .message.received {
        background: #f8f9fa;
        margin-right: 20%;
    }

    .message-info {
        font-size: 0.85rem;
        opacity: 0.8;
        margin-bottom: 0.5rem;
    }

    .chat-input {
        display: flex;
        gap: 1rem;
    }

    .chat-input textarea {
        flex: 1;
        padding: 1rem;
        border: 2px solid #e0e0e0;
        border-radius: 12px;
        resize: none;
    }

    .chat-input button {
        padding: 1rem 2rem;
        border-radius: 12px;
        background: #2f9e44;
        color: white;
        border: none;
        cursor: pointer;
    }
</style>

<div class="chat-container">
    <div class="d-flex align-items-center gap-3 mb-4">
        <div class="avatar">
            {{ other_user.username|first|upper }}
        </div>
        <h2>Chat with @{{ other_user.username }}</h2>
    </div>

    <div class="message-list">
        {% for message in messages %}
        <div class="message {% if message.sender == request.user %}sent{% else %}received{% endif %}">
            <div class="message-info">
                {% if message.sender == request.user %}
                You - {{ message.timestamp|date:"H:i" }}
                {% else %}
                {{ message.sender.username }} - {{ message.timestamp|date:"H:i" }}
                {% endif %}
            </div>
            <p class="mb-0">{{ message.content }}</p>
        </div>
        {% empty %}
        <p class="text-center text-muted">No messages yet. Start the conversation!</p>
        {% endfor %}
    </div>

    <form method="POST" class="chat-input">
        {% csrf_token %}
        <textarea name="content" placeholder="Type your message..." rows="2" required></textarea>
        <button type="submit">
            <i class="fas fa-paper-plane"></i>
        </button>
    </form>
</div>

<script>
    // Auto-scroll to bottom
    const messageList = document.querySelector('.message-list');
    messageList.scrollTop = messageList.scrollHeight;

    // Real-time updates (basic implementation)
    setTimeout(function refresh() {
        window.location.reload();
    }, 30000); // Refresh every 30 seconds
</script>
{% endblock %}